<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œä¿¡æ¯æ£€æµ‹å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            font-size: 14px;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.4em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .main-table-container {
            background: #fff;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 8px;
            overflow-x: auto;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            font-size: 0.9em;
        }

        .info-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            text-align: left;
            font-weight: bold;
            border-bottom: 1px solid #5a6fd8;
            font-size: 0.95em;
        }

        .info-table td {
            padding: 4px 8px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .info-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .info-table tr:hover {
            background-color: #e3f2fd;
        }

        .info-table .label-col {
            font-weight: bold;
            color: #495057;
            width: 25%;
            background-color: rgba(102, 126, 234, 0.05);
        }

        .info-table .value-col {
            color: #007bff;
            font-family: 'Courier New', monospace;
            width: 25%;
        }

        .section-title {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            text-align: center;
            font-size: 1.0em;
            font-weight: bold;
        }

        .compact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn-container {
            text-align: center;
            margin: 8px 0;
        }

        .footer {
            text-align: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
            font-size: 0.75em;
        }


        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-enabled {
            background-color: #d4edda;
            color: #155724;
        }

        .status-disabled {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-unknown {
            background-color: #fff3cd;
            color: #856404;
        }

        .mac-address {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #28a745;
        }

        .ip-address {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #007bff;
        }

        .multi-line-ip {
            line-height: 1.6;
            word-break: break-all;
        }

        .loading {
            color: #ffc107;
        }

        .error {
            color: #dc3545;
        }

        .success {
            color: #28a745;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
            margin: 0 3px;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .online {
            background-color: #28a745;
        }

        .offline {
            background-color: #dc3545;
        }

        .warning {
            background-color: #ffc107;
        }

        .user-agent {
            font-size: 0.8em;
            word-break: break-all;
        }

        .port-note {
            text-align: center;
            font-size: 0.75em;
            color: #6c757d;
            padding: 8px;
        }

        @media (max-width: 768px) {
            .compact-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .container {
                padding: 15px;
            }

            .info-table {
                font-size: 0.85em;
            }

            .info-table th,
            .info-table td {
                padding: 5px 8px;
            }

            .refresh-btn {
                padding: 8px 20px;
                font-size: 0.85em;
                margin: 5px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.2em;
            }

            .info-table {
                font-size: 0.8em;
            }

            .main-table-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸŒ ç½‘ç»œä¿¡æ¯æ£€æµ‹å™¨</h1>

    <div class="btn-container">
        <button class="refresh-btn" onclick="refreshAllInfo()">ğŸ”„ åˆ·æ–°æ‰€æœ‰ä¿¡æ¯</button>
    </div>

    <!-- ä¸»è¦ç½‘ç»œä¿¡æ¯è¡¨æ ¼ -->
    <div class="main-table-container">
        <table class="info-table">
            <thead>
            <tr>
                <th colspan="4" class="section-title">ğŸŒ ç½‘ç»œä¸ç³»ç»Ÿä¿¡æ¯æ€»è§ˆ</th>
            </tr>
            <tr>
                <th>IPåœ°å€ä¿¡æ¯</th>
                <th>ç½‘ç»œçŠ¶æ€</th>
                <th>ç³»ç»Ÿä¿¡æ¯</th>
                <th>DNS/è¿æ¥ä¿¡æ¯</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="label-col">æœ¬åœ°IPåœ°å€</td>
                <td class="label-col">è¿æ¥çŠ¶æ€</td>
                <td class="label-col">æµè§ˆå™¨</td>
                <td class="label-col">DNSæœåŠ¡å™¨</td>
            </tr>
            <tr>
                <td class="value-col loading" id="localIP">æ£€æµ‹ä¸­...</td>
                <td class="value-col" id="networkStatus"><span class="status-indicator online"></span>åœ¨çº¿</td>
                <td class="value-col" id="browser">-</td>
                <td class="value-col loading" id="dnsServers">æ£€æµ‹ä¸­...</td>
            </tr>
            <tr>
                <td class="label-col">å…¬ç½‘IPåœ°å€</td>
                <td class="label-col">è¿æ¥ç±»å‹</td>
                <td class="label-col">æ“ä½œç³»ç»Ÿ</td>
                <td class="label-col">DNSè§£ææ—¶é—´</td>
            </tr>
            <tr>
                <td class="value-col loading" id="publicIP">æ£€æµ‹ä¸­...</td>
                <td class="value-col" id="connectionType">æ£€æµ‹ä¸­...</td>
                <td class="value-col" id="platform">-</td>
                <td class="value-col loading" id="dnsTime">æµ‹è¯•ä¸­...</td>
            </tr>
            <tr>
                <td class="label-col">ç½‘ç»œé€Ÿåº¦</td>
                <td class="label-col">å»¶è¿Ÿ</td>
                <td class="label-col">å±å¹•åˆ†è¾¨ç‡</td>
                <td class="label-col">ä¸»æœºå</td>
            </tr>
            <tr>
                <td class="value-col" id="networkSpeed">æ£€æµ‹ä¸­...</td>
                <td class="value-col loading" id="latency">æµ‹è¯•ä¸­...</td>
                <td class="value-col" id="screenRes">-</td>
                <td class="value-col" id="hostname">-</td>
            </tr>
            <tr>
                <td class="label-col">-</td>
                <td class="label-col">-</td>
                <td class="label-col">ç”¨æˆ·ä»£ç†</td>
                <td class="label-col">åŸŸå</td>
            </tr>
            <tr>
                <td class="label-col">-</td>
                <td class="label-col">-</td>
                <td class="value-col user-agent" id="userAgent">-</td>
                <td class="value-col" id="domain">-</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- ç«¯å£å’ŒWebRTCä¿¡æ¯è¡¨æ ¼ -->
    <div class="compact-grid">
        <div class="main-table-container">
            <table class="info-table">
                <thead>
                <tr>
                    <th colspan="2" class="section-title">ğŸ”Œ ç«¯å£æ£€æµ‹ä¿¡æ¯</th>
                </tr>
                <tr>
                    <th>ç«¯å£/æœåŠ¡</th>
                    <th>çŠ¶æ€</th>
                </tr>
                </thead>
                <tbody id="portTableBody">
                <tr>
                    <td colspan="2" style="text-align: center; color: #ffc107;">æ­£åœ¨æ£€æµ‹å¸¸ç”¨ç«¯å£...</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="main-table-container">
            <table class="info-table">
                <thead>
                <tr>
                    <th colspan="2" class="section-title">ğŸ”— WebRTCè¿æ¥ä¿¡æ¯</th>
                </tr>
                <tr>
                    <th>é¡¹ç›®</th>
                    <th>å€¼</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="label-col">STUNæœåŠ¡å™¨</td>
                    <td class="value-col" id="stunServer">stun.l.google.com:19302</td>
                </tr>
                <tr>
                    <td class="label-col">ICEå€™é€‰</td>
                    <td class="value-col loading" id="iceCandidates">æ”¶é›†ä¸­...</td>
                </tr>
                <tr>
                    <td class="label-col">æœ¬åœ°å€™é€‰</td>
                    <td class="value-col loading" id="localCandidates">æ”¶é›†ä¸­...</td>
                </tr>
                <tr>
                    <td class="label-col">ç½‘ç»œæ¥å£</td>
                    <td class="value-col loading" id="networkInterfaces">æ£€æµ‹ä¸­...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        <p>ğŸ’¡ æç¤ºï¼šå¤–ç½‘IPé€šè¿‡WebRTC STUNæœåŠ¡å™¨è·å–ï¼Œåœ°ç†ä½ç½®ä½¿ç”¨å¤šä¸ªAPIå¤‡é€‰æŸ¥è¯¢</p>
        <p>ğŸ”’ æ­¤å·¥å…·ä»…åœ¨æœ¬åœ°è¿è¡Œï¼Œä¸ä¼šæ”¶é›†æˆ–ä¸Šä¼ ä»»ä½•æ•°æ®</p>
        <p>âš¡ ç«¯å£æ£€æµ‹é€šè¿‡å®é™…è¿æ¥æµ‹è¯•ï¼Œ"-" è¡¨ç¤ºæ— æ³•è¿æ¥æˆ–è¶…æ—¶</p>
    </div>
</div>

<script>
    // å…¨å±€å˜é‡
    let localIPAddresses = [];
    let publicIPInfo = {};

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        initNetworkInfo();
    });

    // åˆå§‹åŒ–æ‰€æœ‰ç½‘ç»œä¿¡æ¯æ£€æµ‹
    function initNetworkInfo() {
        getBrowserInfo();
        getNetworkStatus();
        getLocalIPs();  // ç°åœ¨è¿™ä¸ªå‡½æ•°ä¼šåŒæ—¶è·å–æœ¬åœ°IPå’Œå¤–ç½‘IPï¼Œå¹¶æŸ¥è¯¢ä½ç½®
        testLatency();
        getDNSInfo();
        checkCommonPorts();
        getWebRTCInfo();
    }

    // è·å–æµè§ˆå™¨ä¿¡æ¯
    function getBrowserInfo() {
        const userAgent = navigator.userAgent;
        document.getElementById('userAgent').textContent = userAgent;

        // è§£ææµè§ˆå™¨ç±»å‹ - æ”¹è¿›æ£€æµ‹é¡ºåºï¼Œä¼˜å…ˆæ£€æµ‹ç‰¹æ®Šæƒ…å†µ
        let browserName = "Unknown";

        // Edge æ£€æµ‹ï¼ˆæ–°ç‰ˆå’Œæ—§ç‰ˆï¼‰
        if (userAgent.indexOf("Edg/") > -1 || userAgent.indexOf("Edge/") > -1) {
            browserName = "Edge";
        }
        // Internet Explorer æ£€æµ‹
        else if (userAgent.indexOf("MSIE") > -1 || userAgent.indexOf("Trident/") > -1) {
            browserName = "Internet Explorer";
        }
        // Chrome æ£€æµ‹ï¼ˆéœ€è¦æ’é™¤Edgeå’Œå…¶ä»–åŸºäºChromiumçš„æµè§ˆå™¨ï¼‰
        else if (userAgent.indexOf("Chrome") > -1 && userAgent.indexOf("Safari") > -1) {
            browserName = "Chrome";
        }
        // Firefox æ£€æµ‹
        else if (userAgent.indexOf("Firefox") > -1) {
            browserName = "Firefox";
        }
        // Safari æ£€æµ‹ï¼ˆéœ€è¦æ’é™¤Chromeï¼‰
        else if (userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Chrome") === -1) {
            browserName = "Safari";
        }
        // Opera æ£€æµ‹
        else if (userAgent.indexOf("Opera") > -1 || userAgent.indexOf("OPR") > -1) {
            browserName = "Opera";
        }

        document.getElementById('browser').textContent = browserName;
        document.getElementById('platform').textContent = navigator.platform || '-';

        // å±å¹•åˆ†è¾¨ç‡æ£€æµ‹
        try {
            document.getElementById('screenRes').textContent = `${screen.width} x ${screen.height}`;
        } catch (e) {
            document.getElementById('screenRes').textContent = '-';
        }
    }

    // è·å–ç½‘ç»œçŠ¶æ€
    function getNetworkStatus() {
        // æ£€æµ‹åœ¨çº¿çŠ¶æ€
        const updateOnlineStatus = () => {
            const statusEl = document.getElementById('networkStatus');
            if (navigator.onLine) {
                statusEl.innerHTML = '<span class="status-indicator online"></span>åœ¨çº¿';
            } else {
                statusEl.innerHTML = '<span class="status-indicator offline"></span>ç¦»çº¿';
            }
        };

        updateOnlineStatus();
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // è·å–è¿æ¥ç±»å‹
        if ('connection' in navigator) {
            const conn = navigator.connection;
            const connType = conn.effectiveType || conn.type || 'æœªçŸ¥';
            const downlink = conn.downlink ? `${conn.downlink} Mbps` : 'æœªçŸ¥';

            document.getElementById('connectionType').textContent = connType;
            document.getElementById('networkSpeed').textContent = downlink;
        } else {
            document.getElementById('connectionType').textContent = 'æµè§ˆå™¨ä¸æ”¯æŒ';
            document.getElementById('networkSpeed').textContent = 'æµè§ˆå™¨ä¸æ”¯æŒ';
        }
    }

    // è·å–æœ¬åœ°IPå’Œå¤–ç½‘IPåœ°å€ï¼ˆé€šè¿‡WebRTCï¼‰
    function getLocalIPs() {
        const configuration = {
            iceServers: [
                {urls: 'stun:stun.l.google.com:19302'},
                {urls: 'stun:stun1.l.google.com:19302'},
                {urls: 'stun:stun2.l.google.com:19302'}
            ]
        };

        const pc = new RTCPeerConnection(configuration);
        const localIps = new Set();
        const publicIps = new Set();

        pc.createDataChannel("");

        pc.onicecandidate = function (event) {
            if (event.candidate) {
                const candidate = event.candidate.candidate;
                const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                const ipMatch = candidate.match(ipRegex);

                if (ipMatch) {
                    const ip = ipMatch[1];

                    // åŒºåˆ†æœ¬åœ°IPå’Œå¤–ç½‘IP
                    if (candidate.includes('typ host')) {
                        // æœ¬åœ°ç½‘ç»œæ¥å£IP
                        if (!ip.startsWith('127.') && !ip.startsWith('169.254.')) {
                            localIps.add(ip);
                            localIPAddresses = Array.from(localIps);
                            document.getElementById('localIP').textContent = localIPAddresses.join(', ') || '-';
                            document.getElementById('localIP').className = 'value-col success';
                        }
                    } else if (candidate.includes('typ srflx')) {
                        // STUNæœåŠ¡å™¨åå°„çš„å¤–ç½‘IP
                        publicIps.add(ip);
                        const publicIpsArray = Array.from(publicIps);

                        // å¼‚æ­¥è·å–ä½ç½®å¹¶æ ¼å¼åŒ–æ˜¾ç¤º
                        updatePublicIPDisplay(publicIpsArray);
                    }
                }
            }
        };

        pc.createOffer().then(offer => pc.setLocalDescription(offer));

        // è¶…æ—¶å¤„ç†
        setTimeout(() => {
            if (localIPAddresses.length === 0) {
                document.getElementById('localIP').textContent = '-';
                document.getElementById('localIP').className = 'value-col';
            }
            if (publicIps.size === 0) {
                // å¦‚æœWebRTCè·å–ä¸åˆ°å¤–ç½‘IPï¼Œfallbackåˆ°APIæ–¹å¼
                getPublicIPFallback();
            }
            pc.close();
        }, 8000);
    }

    // æ ¹æ®IPåœ°å€è·å–ä½ç½®ä¿¡æ¯ï¼ˆä¼˜å…ˆçº§æ¨¡å¼ï¼‰
    async function getIPLocation(ip) {
        try {
            // ä½¿ç”¨å¤šä¸ªAPIæœåŠ¡ï¼ŒæŒ‰ä¼˜å…ˆçº§é¡ºåºæŸ¥è¯¢
            const apiTests = [
                // ipinfo.io - å›½å†…ä¸å‡†ï¼Œå›½å¤–å‡†

                // ipapi.co - å¤‡é€‰APIï¼Œç²¾ç¡®åº¦è¾ƒé«˜
                {
                    name: 'ipapi.co',
                    url: `https://ipapi.co/${ip}/json/`,
                    parser: (data) => {
                        if (data.city && data.region && data.country_name) {
                            return `${data.city}, ${data.region}, ${data.country_name}`;
                        } else if (data.country_name) {
                            return data.country_name;
                        }
                        return null;
                    }
                },
                // ipgeolocation.io - å¤‡é€‰API
                {
                    name: 'ipgeolocation.io',
                    url: `https://api.ipgeolocation.io/v2/ipgeo?apiKey=c12f4e421c214d7ea0dbba0f34111261&ip=${ip}`,
                    parser: (data) => {
                        if (data.location.city && data.location.state_prov && data.location.country_name) {
                            return `${data.location.city}, ${data.location.state_prov}, ${data.location.country_name}`;
                        } else if (data.location.country_name) {
                            return data.location.country_name;
                        }
                        return null;
                    }
                },
                // freeipapi.com - å¤‡é€‰API
                {
                    name: 'freeipapi.com',
                    url: `https://free.freeipapi.com/api/json/${ip}`,
                    parser: (data) => {
                        if (data.cityName && data.regionName && data.countryName) {
                            return `${data.cityName}, ${data.regionName}, ${data.countryName}`;
                        } else if (data.countryName) {
                            return data.countryName;
                        }
                        return null;
                    }
                },
                {
                    name: 'ipinfo.io',
                    url: `https://ipinfo.io/${ip}/json`,
                    parser: (data) => {
                        if (data.city && data.region && data.country) {
                            return `${data.city}, ${data.region}, ${data.country}`;
                        } else if (data.country) {
                            return data.country;
                        }
                        return null;
                    }
                },
                // ipip.net - å›½å†…å‡†ï¼Œå›½å¤–ä¸å‡†
                {
                    name: 'ipip.net',
                    url: `http://myip.ipip.net`,
                    parser: (data) => {
                        return data.split("æ¥è‡ªäºï¼š");
                    }
                },

            ];

            console.log(`å¼€å§‹æŸ¥è¯¢IP ${ip} çš„ä½ç½®ä¿¡æ¯...`);

            // æŒ‰ä¼˜å…ˆçº§é¡ºåºå°è¯•æ¯ä¸ªAPI
            for (const apiTest of apiTests) {
                try {
                    console.log(`ğŸ” å°è¯• ${apiTest.name}...`);

                    const response = await fetch(apiTest.url, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(5000), // 5ç§’è¶…æ—¶
                        // headers: {
                        //     'Accept': 'application/json'
                        // }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    const location = apiTest.parser(data);

                    if (location) {
                        console.log(`âœ… ${apiTest.name} æˆåŠŸè¿”å›ä½ç½®:`, location);
                        return location;
                    } else {
                        console.log(`âš ï¸ ${apiTest.name} è¿”å›æ•°æ®ä¸å®Œæ•´`);
                    }

                } catch (e) {
                    console.log(`âŒ ${apiTest.name} æŸ¥è¯¢å¤±è´¥:`, e.message);
                    continue;
                }
            }

            // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥
            console.warn('æ‰€æœ‰IPä½ç½®æŸ¥è¯¢APIéƒ½å¤±è´¥');
            return 'ä½ç½®æœªçŸ¥';

        } catch (error) {
            console.error('IPä½ç½®æŸ¥è¯¢å‡ºé”™:', error);
            return 'ä½ç½®æœªçŸ¥';
        }
    }

    // æ›´æ–°å…¬ç½‘IPæ˜¾ç¤ºï¼ˆåŒ…å«ä½ç½®ä¿¡æ¯ï¼‰
    async function updatePublicIPDisplay(publicIpsArray) {
        try {
            const formattedIPs = [];

            for (const ip of publicIpsArray) {
                console.log(`\nğŸ” å¼€å§‹æŸ¥è¯¢IP ${ip} çš„ä½ç½®ä¿¡æ¯...`);
                const location = await getIPLocation(ip);
                formattedIPs.push(`${ip}ï¼ˆ${location}ï¼‰`);
                console.log(`âœ… IP ${ip} ä½ç½®æŸ¥è¯¢å®Œæˆ: ${location}\n`);
            }

            // è®¾ç½®æ˜¾ç¤ºæ ·å¼
            const element = document.getElementById('publicIP');
            element.style.whiteSpace = 'pre-line';
            element.textContent = formattedIPs.join('\n');
            element.className = 'value-col success multi-line-ip';

            console.log('ğŸ‰ æ‰€æœ‰IPä½ç½®æŸ¥è¯¢å®Œæˆï¼');

        } catch (error) {
            console.error('ä½ç½®æŸ¥è¯¢è¿‡ç¨‹å‡ºé”™:', error);
            // å¦‚æœä½ç½®è·å–å¤±è´¥ï¼Œæ˜¾ç¤ºä¸å¸¦ä½ç½®çš„æ ¼å¼
            const formattedIPs = publicIpsArray.map(ip => `${ip}ï¼ˆä½ç½®æœªçŸ¥ï¼‰`).join('\n');
            const element = document.getElementById('publicIP');
            element.style.whiteSpace = 'pre-line';
            element.textContent = formattedIPs;
            element.className = 'value-col success multi-line-ip';
        }
    }

    // WebRTCè·å–ä¸åˆ°å¤–ç½‘IPæ—¶çš„åå¤‡æ–¹æ¡ˆ
    async function getPublicIPFallback() {
        try {
            // ä½¿ç”¨å¤šä¸ªAPIæœåŠ¡ä»¥æé«˜å¯é æ€§
            const apis = [
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://api.ipify.org?format=json'
            ];

            for (const api of apis) {
                try {
                    const response = await fetch(api);
                    const data = await response.json();

                    if (data.ip) {
                        // ä½¿ç”¨ç»Ÿä¸€çš„æ˜¾ç¤ºæ–¹æ³•
                        await updatePublicIPDisplay([data.ip]);
                        publicIPInfo = data;
                        break;
                    }
                } catch (e) {
                    continue;
                }
            }

            // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥
            const currentText = document.getElementById('publicIP').textContent;
            if (!currentText || currentText === 'æ£€æµ‹ä¸­...' || currentText === '-') {
                throw new Error('æ‰€æœ‰APIéƒ½æ— æ³•è®¿é—®');
            }

        } catch (error) {
            document.getElementById('publicIP').textContent = '-';
            document.getElementById('publicIP').className = 'value-col';
        }
    }

    // ä¿æŒåŸæœ‰çš„getPublicIPå‡½æ•°ä½œä¸ºå…¼å®¹æ€§æ¥å£
    async function getPublicIP() {
        // ç°åœ¨ä¸»è¦é€šè¿‡WebRTCè·å–ï¼Œè¿™é‡Œä½œä¸ºåå¤‡
        return;
    }

    // æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ
    async function testLatency() {
        try {
            const start = performance.now();
            await fetch('https://www.google.com/favicon.ico', {
                mode: 'no-cors',
                cache: 'no-cache'
            });
            const end = performance.now();
            const latency = Math.round(end - start);

            document.getElementById('latency').textContent = `${latency} ms`;
            document.getElementById('latency').className = `value-col ${latency < 100 ? 'success' : latency < 300 ? 'warning' : 'error'}`;
        } catch (error) {
            document.getElementById('latency').textContent = '-';
            document.getElementById('latency').className = 'value-col';
        }
    }

    // è·å–DNSä¿¡æ¯
    async function getDNSInfo() {
        try {
            // æµ‹è¯•DNSè§£ææ—¶é—´
            const start = performance.now();
            await fetch('https://www.google.com', {mode: 'no-cors'});
            const end = performance.now();
            const dnsTime = Math.round(end - start);

            document.getElementById('dnsTime').textContent = `${dnsTime} ms`;
            document.getElementById('dnsTime').className = 'value-col success';

            // è·å–ä¸»æœºåå’ŒåŸŸå
            document.getElementById('hostname').textContent = window.location.hostname || 'localhost';
            document.getElementById('domain').textContent = window.location.host || 'file://';

            // DNSæœåŠ¡å™¨ï¼ˆæµè§ˆå™¨æ— æ³•ç›´æ¥è·å–ï¼‰
            document.getElementById('dnsServers').textContent = '-';
            document.getElementById('dnsServers').className = 'value-col';

        } catch (error) {
            document.getElementById('dnsTime').textContent = '-';
            document.getElementById('dnsTime').className = 'value-col';
            document.getElementById('dnsServers').textContent = '-';
            document.getElementById('dnsServers').className = 'value-col';
        }
    }

    // æ£€æµ‹å¸¸ç”¨ç«¯å£ï¼ˆé€šè¿‡GETè¯·æ±‚æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ï¼‰
    async function checkCommonPorts() {
        const commonServices = [
            {port: 80, name: 'HTTP', testUrl: 'http://httpbin.org/status/200', timeout: 3000},
            {port: 443, name: 'HTTPS', testUrl: 'https://httpbin.org/status/200', timeout: 3000},
            {port: 8080, name: 'HTTP-Alt', testUrl: 'http://httpbin.org:8080/status/200', timeout: 3000},
            {port: 3000, name: 'Dev Server', testUrl: 'http://localhost:3000', timeout: 2000},
            {port: 8000, name: 'Python HTTP', testUrl: 'http://localhost:8000', timeout: 2000},
            {port: 8888, name: 'Jupyter', testUrl: 'http://localhost:8888', timeout: 2000},
            {port: 5000, name: 'Flask', testUrl: 'http://localhost:5000', timeout: 2000},
            {port: 9000, name: 'Dev Tools', testUrl: 'http://localhost:9000', timeout: 2000}
        ];

        const portTableBody = document.getElementById('portTableBody');
        portTableBody.innerHTML = '';

        // åˆ›å»ºåˆå§‹è¡Œï¼Œæ˜¾ç¤ºæ£€æµ‹çŠ¶æ€
        commonServices.forEach(service => {
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td class="label-col">ç«¯å£ ${service.port} (${service.name})</td>
                    <td class="value-col loading" id="port_${service.port}">æ£€æµ‹ä¸­...</td>
                `;
            portTableBody.appendChild(row);
        });

        // å¹¶è¡Œæ£€æµ‹æ‰€æœ‰æœåŠ¡
        const promises = commonServices.map(async (service) => {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), service.timeout);

                const response = await fetch(service.testUrl, {
                    method: 'GET',
                    mode: 'no-cors', // é¿å…CORSé—®é¢˜
                    signal: controller.signal,
                    cache: 'no-cache'
                });

                clearTimeout(timeoutId);

                // no-corsæ¨¡å¼ä¸‹ï¼Œåªèƒ½é€šè¿‡æ˜¯å¦æŠ›å‡ºå¼‚å¸¸æ¥åˆ¤æ–­
                document.getElementById(`port_${service.port}`).innerHTML =
                    '<span class="status-indicator online"></span>å¯è®¿é—®';
                document.getElementById(`port_${service.port}`).className = 'value-col success';

            } catch (error) {
                if (error.name === 'AbortError') {
                    document.getElementById(`port_${service.port}`).textContent = '-';
                } else {
                    document.getElementById(`port_${service.port}`).textContent = '-';
                }
                document.getElementById(`port_${service.port}`).className = 'value-col';
            }
        });

        // ç­‰å¾…æ‰€æœ‰æ£€æµ‹å®Œæˆ
        await Promise.allSettled(promises);

        // æ·»åŠ è¯´æ˜è¡Œ
        const noteRow = document.createElement('tr');
        noteRow.innerHTML = `
                <td colspan="2" class="port-note">
                    ğŸ’¡ æç¤ºï¼šé€šè¿‡å°è¯•è¿æ¥æµ‹è¯•æœåŠ¡å¯ç”¨æ€§ï¼Œ"-" è¡¨ç¤ºæ— æ³•è¿æ¥æˆ–è¶…æ—¶
                </td>
            `;
        portTableBody.appendChild(noteRow);
    }

    // è·å–WebRTCä¿¡æ¯
    function getWebRTCInfo() {
        const configuration = {
            iceServers: [
                {urls: 'stun:stun.l.google.com:19302'}
            ]
        };

        const pc = new RTCPeerConnection(configuration);
        const candidates = [];
        const localCandidates = [];

        pc.createDataChannel("");

        pc.onicecandidate = function (event) {
            if (event.candidate) {
                candidates.push(event.candidate.candidate);

                // åŒºåˆ†æœ¬åœ°å’Œè¿œç¨‹å€™é€‰
                if (event.candidate.candidate.includes('typ host')) {
                    localCandidates.push(event.candidate.candidate);
                }

                document.getElementById('iceCandidates').textContent = `${candidates.length} ä¸ª`;
                document.getElementById('iceCandidates').className = 'value-col success';

                document.getElementById('localCandidates').textContent = `${localCandidates.length} ä¸ª`;
                document.getElementById('localCandidates').className = 'value-col success';

                // è§£æç½‘ç»œæ¥å£ç±»å‹
                const interfaces = new Set();
                candidates.forEach(candidate => {
                    if (candidate.includes('typ host')) interfaces.add('Host');
                    if (candidate.includes('typ srflx')) interfaces.add('Server Reflexive');
                    if (candidate.includes('typ relay')) interfaces.add('Relay');
                    if (candidate.includes('typ prflx')) interfaces.add('Peer Reflexive');
                });

                document.getElementById('networkInterfaces').textContent = Array.from(interfaces).join(', ') || 'æ— ';
                document.getElementById('networkInterfaces').className = 'value-col success';
            }
        };

        pc.onicegatheringstatechange = function () {
            if (pc.iceGatheringState === 'complete') {
                setTimeout(() => pc.close(), 1000);
            }
        };

        pc.createOffer().then(offer => pc.setLocalDescription(offer));

        // è¶…æ—¶å¤„ç†
        setTimeout(() => {
            if (candidates.length === 0) {
                document.getElementById('iceCandidates').textContent = '-';
                document.getElementById('iceCandidates').className = 'value-col';
                document.getElementById('localCandidates').textContent = '-';
                document.getElementById('localCandidates').className = 'value-col';
                document.getElementById('networkInterfaces').textContent = '-';
                document.getElementById('networkInterfaces').className = 'value-col';
            }
            pc.close();
        }, 10000);
    }

    // åˆ·æ–°æ‰€æœ‰ä¿¡æ¯
    function refreshAllInfo() {
        // é‡ç½®åŠ è½½çŠ¶æ€
        document.querySelectorAll('.loading').forEach(el => {
            el.textContent = 'æ£€æµ‹ä¸­...';
            el.className = 'value-col loading';
        });

        // é‡ç½®æ‰€æœ‰æ˜¾ç¤ºå…ƒç´ 
        document.getElementById('publicIP').textContent = 'æ£€æµ‹ä¸­...';
        document.getElementById('publicIP').className = 'value-col loading';
        document.getElementById('localIP').textContent = 'æ£€æµ‹ä¸­...';
        document.getElementById('localIP').className = 'value-col loading';

        // æ¸…ç©ºç¼“å­˜
        localIPAddresses = [];
        publicIPInfo = {};

        // é‡æ–°æ£€æµ‹
        setTimeout(() => {
            initNetworkInfo();
        }, 500);
    }


    // æ·»åŠ é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function (event) {
        if (event.ctrlKey && event.key === 'r') {
            event.preventDefault();
            refreshAllInfo();
        }
    });

    // æ·»åŠ å¤åˆ¶åŠŸèƒ½
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function () {
            // å¯ä»¥æ·»åŠ å¤åˆ¶æˆåŠŸæç¤º
        });
    }

    // ä¸ºIPåœ°å€æ·»åŠ ç‚¹å‡»å¤åˆ¶åŠŸèƒ½
    document.addEventListener('click', function (event) {
        if (event.target.classList.contains('value-col') &&
            (event.target.id === 'localIP' || event.target.id === 'publicIP')) {
            const text = event.target.textContent;
            if (text && !text.includes('æ£€æµ‹ä¸­') && !text.includes('å¤±è´¥')) {
                copyToClipboard(text);
                const originalText = text;
                event.target.textContent = 'å·²å¤åˆ¶!';
                setTimeout(() => {
                    event.target.textContent = originalText;
                }, 1000);
            }
        }
    });

</script>
</body>
</html>

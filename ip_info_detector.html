<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œIPç›¸å…³ä¿¡æ¯</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            font-size: 12px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        h1::before { content: "ğŸ–¥ï¸"; margin-right: 10px; }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover { transform: translateY(-1px); }
        
        .main-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 0.8em;
        }
        
        .main-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.85em;
        }

        .main-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
            vertical-align: middle;
            word-break: break-all;
            max-width: 120px;
        }
        
        .main-table tr:nth-child(even) { background-color: #f8f9fa; }
        .main-table tr:hover { background-color: #e3f2fd; }
        
        .adapter-name {
            font-weight: bold;
            color: #495057;
            text-align: left;
            max-width: 180px;
            word-break: break-word;
        }

        .ip-address {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #007bff;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
        }
        
        .ip-address:hover { background-color: rgba(0, 123, 255, 0.1); }

        .mac-address {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #28a745;
            cursor: pointer;
            font-size: 0.75em;
        }
        
        .mac-address:hover { background-color: rgba(40, 167, 69, 0.1); }
        
        .status-connected { color: #28a745; font-weight: bold; }
        .status-disconnected { color: #dc3545; font-weight: bold; }
        .status-enabled { color: #28a745; }
        .status-disabled { color: #dc3545; }
        
        .stats {
            display: flex;
            justify-content: space-around;
                margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-item { text-align: center; }
        .stat-number { font-size: 1.3em; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 0.75em; color: #6c757d; }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .page-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            cursor: pointer;
        }
        
        .page-btn.active { background: linear-gradient(45deg, #667eea, #764ba2); }
        .page-btn:disabled { background: #dee2e6; cursor: not-allowed; }
        
        .tooltip {
            position: fixed;
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip.show { opacity: 1; }
        
        @media (max-width: 1200px) {
            .main-table { font-size: 0.7em; }
            .main-table th, .main-table td { padding: 4px 6px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç½‘ç»œIPç›¸å…³ä¿¡æ¯</h1>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalAdapters">-</div>
                <div class="stat-label">ç½‘ç»œæ¥å£</div>
        </div>
            <div class="stat-item">
                <div class="stat-number" id="activeAdapters">-</div>
                <div class="stat-label">æ´»åŠ¨æ¥å£</div>
                </div>
            <div class="stat-item">
                <div class="stat-number" id="dhcpEnabled">-</div>
                <div class="stat-label">æ£€æµ‹åˆ°IP</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ipv4Count">-</div>
                <div class="stat-label">IPv4åœ°å€</div>
            </div>
        </div>

        <!-- é‡è¦è¯´æ˜ -->
        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 0.85em;">
            <div style="color: #856404; font-weight: bold; margin-bottom: 5px;">âš ï¸ æµè§ˆå™¨å®‰å…¨é™åˆ¶è¯´æ˜</div>
            <div style="color: #664d03;">
                <strong>ä»…æ˜¾ç¤ºå®æ—¶æ£€æµ‹æ•°æ®ï¼š</strong> é¡µé¢é€šè¿‡WebRTCæŠ€æœ¯æ£€æµ‹çœŸå®çš„æœ¬åœ°IPåœ°å€ã€‚
                æ‰€æœ‰æ— æ³•é€šè¿‡æµè§ˆå™¨å®‰å…¨æœºåˆ¶è·å–çš„ä¿¡æ¯ï¼ˆå¦‚MACåœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ã€DHCPã€DNSç­‰ï¼‰å‡æ˜¾ç¤ºä¸º <strong>"-"</strong>ã€‚
                <br><strong>è·å–å®Œæ•´ä¿¡æ¯ï¼š</strong> è¯·åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>ipconfig /all</code> è·å–å®Œæ•´çš„ç½‘ç»œé…ç½®ä¿¡æ¯ã€‚
                <br><span style="font-size: 0.8em; opacity: 0.8;">æ¥å£åç§°åŸºäºIPåœ°å€èŒƒå›´è¿›è¡Œæ¨æµ‹ï¼Œä»…ä¾›å‚è€ƒã€‚</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°</button>
            <button class="btn" onclick="exportData()">ğŸ“¥ å¯¼å‡º</button>
            <button class="btn" onclick="openDevConsole()" title="æŸ¥çœ‹æ£€æµ‹æ—¥å¿—">ğŸ” è°ƒè¯•</button>
            <span>æ¯é¡µ: <select id="pageSize" onchange="changePageSize()">
                <option value="12" selected>12æ¡</option>
                <option value="15">15æ¡</option>
                <option value="20">20æ¡</option>
            </select></span>
            <span>å…± <span id="totalCount">0</span> æ¡</span>
            </div>

        <table class="main-table">
                    <thead>
                        <tr>
                    <th style="width: 16%">æ¥å£åç§°</th>
                    <th style="width: 10%">ç±»å‹</th>
                    <th style="width: 8%">çŠ¶æ€</th>
                    <th style="width: 11%">IPåœ°å€</th>
                    <th style="width: 9%">å­ç½‘æ©ç </th>
                    <th style="width: 10%">ç½‘å…³</th>
                    <th style="width: 13%">MACåœ°å€</th>
                    <th style="width: 7%">DHCP</th>
                    <th style="width: 12%">DNSæœåŠ¡å™¨</th>
                    <th style="width: 4%">MTU</th>
                        </tr>
                    </thead>
            <tbody id="tableBody">
                        <tr>
                    <td colspan="10" style="padding: 30px; color: #6c757d;">ğŸ” æ­£åœ¨æ£€æµ‹ç½‘ç»œæ¥å£...</td>
                        </tr>
                    </tbody>
                </table>
        
        <div class="pagination" id="pagination" style="display: none;">
            <button class="page-btn" id="prevBtn" onclick="prevPage()">ä¸Šä¸€é¡µ</button>
            <span id="pageNumbers"></span>
            <button class="page-btn" id="nextBtn" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
        </div>

        <div style="text-align: center; margin-top: 15px; font-size: 0.8em; color: #6c757d; padding: 10px; background: rgba(108, 117, 125, 0.1); border-radius: 8px;">
            ğŸ’¡ ç‚¹å‡»æ£€æµ‹åˆ°çš„IPåœ°å€å¯å¤åˆ¶åˆ°å‰ªè´´æ¿ | "-" è¡¨ç¤ºæµè§ˆå™¨æ— æ³•è·å–çš„ä¿¡æ¯
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        let allAdapters = [];
        let currentPage = 1;
        let pageSize = 12;
        let localIPs = [];
        
        document.addEventListener('DOMContentLoaded', initializeData);
        
        async function initializeData() {
            try {
                await detectLocalIPs();
                allAdapters = await generateAdapters();
                updateStats();
                renderTable();
            } catch (error) {
                showError('è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥');
            }
        }
        
        function detectLocalIPs() {
            return new Promise((resolve) => {
                const pc = new RTCPeerConnection({
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' },
                        { urls: 'stun:stun.qq.com:3478' },
                        { urls: 'stun:stun.miwifi.com:3478' }
                ]
                });

            const ips = new Set();
                const candidates = [];
                let candidateCount = 0;

            pc.createDataChannel("");

                pc.onicecandidate = (event) => {
                if (event.candidate) {
                        candidateCount++;
                    const candidate = event.candidate.candidate;
                        candidates.push(candidate);
                        
                        // æå–IPv4åœ°å€
                        const ipv4Match = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                        if (ipv4Match) {
                            const ip = ipv4Match[1];
                            // åŒ…å«æ›´å¤šæœ¬åœ°IPèŒƒå›´
                            if (!ip.startsWith('127.') && 
                                !ip.startsWith('0.') && 
                                ip !== '255.255.255.255') {
                            ips.add(ip);
                                localIPs = Array.from(ips);
                                console.log('æ£€æµ‹åˆ°IP:', ip);
                            }
                        }
                        
                        // æå–IPv6åœ°å€
                        const ipv6Match = candidate.match(/([0-9a-fA-F:]+::[0-9a-fA-F:]*)/);
                        if (ipv6Match && !ipv6Match[1].startsWith('::1')) {
                            ips.add(ipv6Match[1]);
                            localIPs = Array.from(ips);
                            console.log('æ£€æµ‹åˆ°IPv6:', ipv6Match[1]);
                        }
                        
                        console.log(`å·²æ”¶é›†${candidateCount}ä¸ªICEå€™é€‰ï¼Œå‘ç°${ips.size}ä¸ªIP`);
                }
            };

            pc.createOffer().then(offer => pc.setLocalDescription(offer));

                // å»¶é•¿æ£€æµ‹æ—¶é—´ï¼Œè®©æ›´å¤šé€‚é…å™¨è¢«å‘ç°
            setTimeout(() => {
                pc.close();
                    console.log('IPæ£€æµ‹å®Œæˆï¼Œå…±å‘ç°:', Array.from(ips));
                    resolve(); 
                }, 8000);
            });
        }
        
        function generateAdapters() {
            const adapters = [];
            console.log('ç”Ÿæˆé€‚é…å™¨ï¼Œæ£€æµ‹åˆ°çš„IP:', localIPs);
            
            // åŸºäºæ£€æµ‹åˆ°çš„çœŸå®IPç”Ÿæˆé€‚é…å™¨
            localIPs.forEach((ip, index) => {
                let adapterName, type, status = "å·²è¿æ¥", active = true;
                
                // åŸºäºIPåœ°å€æ¨æµ‹é€‚é…å™¨åç§°å’Œç±»å‹
                if (ip.startsWith('192.168.1.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: ä»¥å¤ªç½‘)`;
                    type = "ä»¥å¤ªç½‘";
                } else if (ip.startsWith('192.168.170.') || ip.startsWith('192.168.221.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: VMware)`;
                    type = "è™šæ‹Ÿç½‘å¡";
                } else if (ip.startsWith('198.18.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: ä»£ç†)`;
                    type = "ä»£ç†é€‚é…å™¨";
                } else if (ip.startsWith('172.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: å®¹å™¨)`;
                    type = "è™šæ‹Ÿç½‘å¡";
                } else if (ip.startsWith('10.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: VPN)`;
                    type = "VPN";
                } else if (ip.startsWith('169.254.')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (æ¨æµ‹: é“¾è·¯æœ¬åœ°)`;
                    type = "é“¾è·¯æœ¬åœ°";
                    status = "å—é™è¿æ¥";
                    active = false;
                } else if (ip.includes(':')) {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1} (IPv6)`;
                    type = "IPv6";
                } else {
                    adapterName = `ç½‘ç»œæ¥å£ ${index + 1}`;
                    type = "æœªçŸ¥";
                }
                
                adapters.push({
                    name: adapterName,
                    type: type,
                    status: status,
                    ipAddress: ip,
                    subnetMask: "-",
                    gateway: "-",
                    macAddress: "-",
                    dhcp: "-",
                    dns: "-",
                    mtu: "-",
                    active: active
                });
            });
            
            // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°IPï¼Œæ˜¾ç¤ºæ— æ³•æ£€æµ‹çš„æç¤º
            if (adapters.length === 0) {
                adapters.push({
                    name: "æ— æ³•æ£€æµ‹ç½‘ç»œæ¥å£",
                    type: "æœªçŸ¥",
                    status: "æ— æ³•æ£€æµ‹",
                    ipAddress: "æ— æ³•æ£€æµ‹",
                    subnetMask: "-",
                    gateway: "-",
                    macAddress: "-",
                    dhcp: "-",
                    dns: "-",
                    mtu: "-",
                    active: false
                });
            }
            
            // æ·»åŠ ç¯å›æ¥å£ï¼ˆè¿™ä¸ªæ˜¯å·²çŸ¥çš„æ ‡å‡†æ¥å£ï¼‰
            adapters.push({
                name: "Loopback Interface",
                type: "ç¯å›æ¥å£",
                status: "å·²è¿æ¥",
                ipAddress: "127.0.0.1",
                subnetMask: "-",
                gateway: "-",
                macAddress: "-",
                dhcp: "-",
                dns: "-",
                mtu: "-",
                active: true
            });
            
            return adapters;
        }

        
        function updateStats() {
            document.getElementById('totalAdapters').textContent = allAdapters.length;
            document.getElementById('activeAdapters').textContent = allAdapters.filter(a => a.active).length;
            document.getElementById('dhcpEnabled').textContent = localIPs.length;
            document.getElementById('ipv4Count').textContent = allAdapters.filter(a => a.ipAddress.includes('.') && !a.ipAddress.includes('æ— æ³•')).length;
            document.getElementById('totalCount').textContent = allAdapters.length;
        }
        
        function renderTable() {
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = allAdapters.slice(start, end);
            
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = pageData.map(adapter => `
                <tr>
                    <td class="adapter-name">${adapter.name}</td>
                    <td>${adapter.type}</td>
                    <td class="${adapter.active ? 'status-connected' : 'status-disconnected'}">${adapter.status}</td>
                    <td class="${adapter.ipAddress !== '-' && !adapter.ipAddress.includes('æ— æ³•') ? 'ip-address' : ''}" 
                        ${adapter.ipAddress !== '-' && !adapter.ipAddress.includes('æ— æ³•') ? `onclick="copyText('${adapter.ipAddress}')"` : ''}>
                        ${adapter.ipAddress}
                    </td>
                    <td>${adapter.subnetMask}</td>
                    <td>${adapter.gateway}</td>
                    <td>${adapter.macAddress}</td>
                    <td>${adapter.dhcp}</td>
                    <td>${adapter.dns}</td>
                    <td>${adapter.mtu}</td>
                </tr>
            `).join('');
            
            renderPagination();
        }
        
        function renderPagination() {
            const totalPages = Math.ceil(allAdapters.length / pageSize);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => goToPage(i);
                pageNumbers.appendChild(btn);
            }
        }
        
        function goToPage(page) { currentPage = page; renderTable(); }
        function prevPage() { if (currentPage > 1) { currentPage--; renderTable(); } }
        function nextPage() { 
            if (currentPage < Math.ceil(allAdapters.length / pageSize)) { 
                currentPage++; renderTable(); 
            } 
        }
        
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderTable();
        }
        
        function refreshData() {
            document.getElementById('tableBody').innerHTML = '<tr><td colspan="10" style="padding: 30px;">ğŸ”„ åˆ·æ–°ä¸­...</td></tr>';
            setTimeout(initializeData, 1000);
        }
        
        function exportData() {
            let csv = "æ¥å£åç§°,ç±»å‹,çŠ¶æ€,IPåœ°å€,å­ç½‘æ©ç ,ç½‘å…³,MACåœ°å€,DHCP,DNSæœåŠ¡å™¨,MTU\n";
            allAdapters.forEach(a => {
                csv += `"${a.name}","${a.type}","${a.status}","${a.ipAddress}","${a.subnetMask}","${a.gateway}","${a.macAddress}","${a.dhcp}","${a.dns}","${a.mtu}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ç½‘ç»œIPä¿¡æ¯_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showTooltip('å·²å¯¼å‡ºCSVæ–‡ä»¶');
        }
        
        function copyText(text) {
            if (text === '-' || text === 'ä¸é€‚ç”¨') return;
            navigator.clipboard.writeText(text).then(() => showTooltip(`å·²å¤åˆ¶: ${text}`));
        }
        
        function showTooltip(msg) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = msg;
            tooltip.style.top = '50%';
            tooltip.style.left = '50%';
            tooltip.style.transform = 'translate(-50%, -50%)';
            tooltip.classList.add('show');
            setTimeout(() => tooltip.classList.remove('show'), 2000);
        }
        
        function showError(msg) {
            document.getElementById('tableBody').innerHTML = `<tr><td colspan="10" style="padding: 30px; color: #dc3545;">âŒ ${msg}</td></tr>`;
        }
        
        function openDevConsole() {
            alert('è¯·æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåœ¨Consoleæ ‡ç­¾é¡µä¸­æŸ¥çœ‹ç½‘ç»œæ£€æµ‹çš„è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚\n\næ—¥å¿—åŒ…å«ï¼š\n- WebRTCæ£€æµ‹åˆ°çš„æ‰€æœ‰IPåœ°å€\n- ICEå€™é€‰æ”¶é›†è¿‡ç¨‹\n- é€‚é…å™¨æ¨æµ‹é€»è¾‘\n- æ£€æµ‹å¤±è´¥çš„åŸå› ç­‰\n\næ³¨æ„ï¼šé¡µé¢ä»…æ˜¾ç¤ºçœŸå®æ£€æµ‹åˆ°çš„IPåœ°å€ï¼Œå…¶ä»–ä¿¡æ¯å‡ä¸º"-"');
        }
    </script>
</body>
</html>

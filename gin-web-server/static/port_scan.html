<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÖ¨ÁΩëÁ´ØÂè£Ê£ÄÊµã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            font-size: 14px;
            overflow-x: auto;
        }

        .container {
            position: fixed;
            top: 0px;
            left: 6px;
            right: 6px;
            bottom: 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        h1::before {
            content: "üîç";
            margin-right: 15px;
        }

        .main-layout {
            flex: 1;
            display: grid;
            grid-template-columns: 420px 1fr;
            grid-template-rows: 1fr;
            grid-template-areas:
                "config right";
            gap: 15px;
            min-height: 0;
        }

        .right-panel {
            grid-area: right;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Â∑¶‰æßÈÖçÁΩÆÂå∫Âüü */
        .config-panel {
            grid-area: config;
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .config-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-title {
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            height: 30px;
            flex-shrink: 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background-color: white;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .ports-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .ports-input {
            flex: 1;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .clear-btn:hover {
            background: #c82333;
        }

        .port-shortcuts {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        .port-shortcut {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .port-shortcut:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .port-shortcut.selected {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }

        .scan-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-shrink: 0;
        }

        .scan-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
            transition: all 0.3s;
        }

        .scan-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .scan-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Âè≥‰∏äÁªìÊûúÂå∫Âüü */
        .result-area {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex: 2;
            min-height: 0;
        }

        /* Âè≥‰∏ãÊó•ÂøóÂå∫Âüü */
        .log-area {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex: 1;
            min-height: 0;
            max-height: 250px;
        }

        .panel-header {
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            height: 30px;
            flex-shrink: 0;
        }

        .panel-title {
            font-size: 0.9em;
            font-weight: bold;
            color: #333;
        }

        .panel-actions {
            display: flex;
            gap: 8px;
        }

        .panel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .panel-btn:hover {
            background: #5a6268;
        }

        .panel-btn.save {
            background: #28a745;
        }

        .panel-btn.save:hover {
            background: #218838;
        }

        .panel-btn.clear {
            background: #dc3545;
        }

        .panel-btn.clear:hover {
            background: #c82333;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .result-content {
            flex: 1;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            min-height: 0;
        }

        .log-content {
            flex: 1;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            min-height: 0;
            max-height: 100%;
            word-wrap: break-word;
        }

        .log-message {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 4px;
            background: #ffffff;
            border-left: 3px solid #6c757d;
        }

        .log-message.info {
            border-left-color: #17a2b8;
            background: #e7f3ff;
        }

        .log-message.success {
            border-left-color: #28a745;
            background: #eaf5ea;
        }

        .log-message.warning {
            border-left-color: #ffc107;
            background: #fff8e1;
        }

        .log-message.error {
            border-left-color: #dc3545;
            background: #ffeaea;
        }

        .log-time {
            color: #666;
            font-size: 0.9em;
            margin-right: 8px;
        }

        .log-type {
            font-weight: bold;
            margin-right: 8px;
            text-transform: uppercase;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(45deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.3s;
            width: 0%;
        }

        .status-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            font-size: 12px;
        }

        .status-card.open {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .status-card.closed {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .status-card.timeout {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .status-card.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .status-count {
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                grid-template-areas:
                    "config"
                    "right";
            }

            .right-panel {
                min-height: 600px;
            }

            .result-area {
                flex: 2;
            }

            .log-area {
                flex: 1;
                max-height: 200px;
            }

            .config-panel {
                max-height: none;
            }

            .port-shortcuts {
                grid-template-columns: repeat(4, 1fr);
                max-height: 120px;
            }

            .status-summary {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .port-shortcuts {
                grid-template-columns: repeat(3, 1fr);
            }

            .status-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ÂÖ¨ÁΩëÁ´ØÂè£Ê£ÄÊµã</h1>

        <div class="main-layout">
            <!-- Â∑¶‰æßÈÖçÁΩÆÂå∫Âüü -->
            <div class="config-panel">
                <div class="config-section">
                    <div class="section-title">‚öôÔ∏è Êâ´ÊèèÈÖçÁΩÆ</div>

                    <div class="form-group">
                        <label class="form-label">ÁõÆÊ†áIPÂú∞ÂùÄ</label>
                        <input type="text" class="form-input" id="hostInput" placeholder="ËØ∑ËæìÂÖ•IPÂú∞ÂùÄÔºå‰æãÂ¶ÇÔºö8.8.8.8" value="115.190.5.236">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Êâ´ÊèèËåÉÂõ¥</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="scanType" value="all" id="scanAll">
                                <span>ÂÖ®Á´ØÂè£ (1-65535)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="scanType" value="custom" id="scanCustom" checked>
                                <span>Ëá™ÂÆö‰πâ</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="customPortsGroup">
                        <label class="form-label">Á´ØÂè£ÂàóË°® (Áî®ÈÄóÂè∑ÂàÜÈöîÔºåËåÉÂõ¥Êü•ËØ¢Áî® [-]Ôºå‰æãÔºö8000-9000 )</label>
                        <div class="ports-input-group">
                            <input type="text" class="form-input ports-input" id="portsInput"
                                   placeholder="‰æãÂ¶ÇÔºö22,80,443,8080 Êàñ 8000-9000" value="8000-8099,80,3306,6379">
                            <button class="clear-btn" onclick="clearPorts()">Ê∏ÖÁ©∫</button>
                        </div>

                        <div class="port-shortcuts" id="portShortcuts">
                            <div class="port-shortcut" data-port="80" data-name="nginx">nginx:80</div>
                            <div class="port-shortcut" data-port="8080" data-name="tomcat">tomcat:8080</div>
                            <div class="port-shortcut" data-port="22" data-name="ssh">ssh:22</div>
                            <div class="port-shortcut" data-port="6379" data-name="redis">redis:6379</div>
                            <div class="port-shortcut" data-port="27017" data-name="mongodb">mongodb:27017</div>
                            <div class="port-shortcut" data-port="3306" data-name="mysql">mysql:3306</div>
                            <div class="port-shortcut" data-port="5432" data-name="pgsql">pgsql:5432</div>
                            <div class="port-shortcut" data-port="1521" data-name="oracle">oracle:1521</div>
                            <div class="port-shortcut" data-port="5236" data-name="dameng">dameng:5236</div>
                            <div class="port-shortcut" data-port="1433" data-name="sqlserver">sqlserver:1433</div>
                            <div class="port-shortcut" data-port="9200" data-name="elasticsearch">elasticsearch:9200</div>
                            <div class="port-shortcut" data-port="9092" data-name="kafka">kafka:9092</div>
                            <div class="port-shortcut" data-port="5672" data-name="rabbitmq">rabbitmq:5672</div>
                            <div class="port-shortcut" data-port="9876" data-name="rocketmq">rocketmq:9876</div>
                            <div class="port-shortcut" data-port="61616" data-name="activemq">activemq:61616</div>
                            <div class="port-shortcut" data-port="2181" data-name="zookeeper">zookeeper:2181</div>
                            <div class="port-shortcut" data-port="5601" data-name="kibana">kibana:5601</div>
                            <div class="port-shortcut" data-port="8500" data-name="consul">consul:8500</div>
                        </div>
                    </div>

                    <div class="scan-controls">
                        <button class="scan-btn" id="scanBtn" onclick="startScan()">üöÄ ÂºÄÂßãÊâ´Êèè</button>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÈù¢Êùø -->
            <div class="right-panel">
                <!-- Âè≥‰∏äÁªìÊûúÂå∫Âüü -->
                <div class="result-area">
                    <div class="panel-header">
                        <div class="panel-title">üìä Êâ´ÊèèÁªìÊûú</div>
                        <div class="panel-actions">
                            <button class="panel-btn save" onclick="saveResult()">‰øùÂ≠ò</button>
                            <button class="panel-btn clear" onclick="clearResult()">Ê∏ÖÁ©∫</button>
                        </div>
                    </div>

                    <div class="progress-bar" id="progressBar" style="display: none;">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>

                    <div class="status-summary" id="statusSummary" style="display: none;">
                        <div class="status-card open">
                            <span class="status-count" id="openCount">0</span>
                            ÂºÄÊîæ
                        </div>
                        <div class="status-card closed">
                            <span class="status-count" id="closedCount">0</span>
                            ÂÖ≥Èó≠
                        </div>
                        <div class="status-card timeout">
                            <span class="status-count" id="timeoutCount">0</span>
                            Ë∂ÖÊó∂
                        </div>
                        <div class="status-card error">
                            <span class="status-count" id="errorCount">0</span>
                            ÈîôËØØ
                        </div>
                    </div>

                    <div class="result-content" id="resultContent">
                        ÁÇπÂáª"ÂºÄÂßãÊâ´Êèè"ÂºÄÂßãÁ´ØÂè£Ê£ÄÊµã...
                    </div>
                </div>

                <!-- Âè≥‰∏ãÊó•ÂøóÂå∫Âüü -->
                <div class="log-area">
                    <div class="panel-header">
                        <div class="panel-title">üìù Êâ´ÊèèÊó•Âøó</div>
                        <div class="panel-actions">
                            <button class="panel-btn" id="autoScrollBtn" onclick="toggleAutoScroll()">üìú Ëá™Âä®ÊªöÂä®</button>
                            <button class="panel-btn save" onclick="saveLog()">‰øùÂ≠ò</button>
                            <button class="panel-btn clear" onclick="clearLog()">Ê∏ÖÁ©∫</button>
                        </div>
                    </div>

                    <div class="log-content" id="logContent">
                        <!-- Êó•ÂøóÂÜÖÂÆπ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoScroll = true;
        let isScanning = false;
        let selectedPorts = new Set();

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initPortShortcuts();
            initScanTypeToggle();
            logMessage('info', 'Á´ØÂè£Êâ´ÊèèÂ∑•ÂÖ∑ÂàùÂßãÂåñÂÆåÊàê');
        });

        // ÂàùÂßãÂåñÁ´ØÂè£Âø´Êç∑ÊñπÂºè
        function initPortShortcuts() {
            const shortcuts = document.querySelectorAll('.port-shortcut');
            shortcuts.forEach(shortcut => {
                shortcut.addEventListener('click', function() {
                    const port = this.getAttribute('data-port');
                    const name = this.getAttribute('data-name');
                    togglePortSelection(port, name, this);
                });
            });
        }

        // ÂàùÂßãÂåñÊâ´ÊèèÁ±ªÂûãÂàáÊç¢
        function initScanTypeToggle() {
            const scanAll = document.getElementById('scanAll');
            const scanCustom = document.getElementById('scanCustom');
            const customPortsGroup = document.getElementById('customPortsGroup');

            scanAll.addEventListener('change', function() {
                if (this.checked) {
                    customPortsGroup.style.display = 'none';
                }
            });

            scanCustom.addEventListener('change', function() {
                if (this.checked) {
                    customPortsGroup.style.display = 'block';
                }
            });
        }

        // ÂàáÊç¢Á´ØÂè£ÈÄâÊã©
        function togglePortSelection(port, name, element) {
            const portsInput = document.getElementById('portsInput');
            let currentPorts = portsInput.value.trim();

            if (selectedPorts.has(port)) {
                // ÁßªÈô§Á´ØÂè£
                selectedPorts.delete(port);
                element.classList.remove('selected');

                // ‰ªéËæìÂÖ•Ê°Ü‰∏≠ÁßªÈô§
                const portsArray = currentPorts.split(',').map(p => p.trim()).filter(p => p !== '' && p !== port);
                portsInput.value = portsArray.join(',');

                logMessage('info', `Â∑≤ÁßªÈô§Á´ØÂè£: ${port} (${name})`);
            } else {
                // Ê∑ªÂä†Á´ØÂè£
                selectedPorts.add(port);
                element.classList.add('selected');

                // Ê∑ªÂä†Âà∞ËæìÂÖ•Ê°Ü
                if (currentPorts === '') {
                    portsInput.value = port;
                } else {
                    portsInput.value = currentPorts + ',' + port;
                }

                logMessage('info', `Â∑≤Ê∑ªÂä†Á´ØÂè£: ${port} (${name})`);
            }
        }

        // Ê∏ÖÁ©∫Á´ØÂè£
        function clearPorts() {
            document.getElementById('portsInput').value = '';
            selectedPorts.clear();

            // ÁßªÈô§ÊâÄÊúâÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.port-shortcut.selected').forEach(el => {
                el.classList.remove('selected');
            });

            logMessage('info', 'Â∑≤Ê∏ÖÁ©∫ÊâÄÊúâÁ´ØÂè£');
        }

        // ÂºÄÂßãÊâ´Êèè
        async function startScan() {
            const hostInput = document.getElementById('hostInput');
            const portsInput = document.getElementById('portsInput');
            const scanAll = document.getElementById('scanAll');
            const scanBtn = document.getElementById('scanBtn');

            let host = hostInput.value.trim();
            if (!host) {
                host = '115.190.5.236';
                hostInput.value = host;
                logMessage('info', '‰ΩøÁî®ÈªòËÆ§IPÂú∞ÂùÄ: 115.190.5.236');
            }

            // IPÂú∞ÂùÄÊ†ºÂºèÈ™åËØÅ
            const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            if (!ipRegex.test(host)) {
                logMessage('error', 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑIPÂú∞ÂùÄÊ†ºÂºè');
                return;
            }

            let ports = '';
            let scanAllPorts = scanAll.checked;

            if (!scanAllPorts) {
                ports = portsInput.value.trim();
                if (!ports) {
                    ports = '8000-8099,80,3306,6379';
                    portsInput.value = ports;
                    logMessage('info', '‰ΩøÁî®ÈªòËÆ§Á´ØÂè£: 8000-8099,80,3306,6379');
                }
            }

            // ÂºÄÂßãÊâ´Êèè
            isScanning = true;
            scanBtn.disabled = true;
            scanBtn.textContent = '‚è≥ Êâ´Êèè‰∏≠...';

            // ÊòæÁ§∫ËøõÂ∫¶Êù°
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';

            logMessage('info', `ÂºÄÂßãÊâ´Êèè‰∏ªÊú∫: ${host}`);
            if (scanAllPorts) {
                logMessage('info', 'Êâ´ÊèèÁ±ªÂûã: ÂÖ®Á´ØÂè£ (1-65535)');
            } else {
                logMessage('info', `Êâ´ÊèèÁ´ØÂè£: ${ports}`);
            }

            try {
                const response = await fetch('/port-scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        host: host,
                        ports: ports,
                        scanAll: scanAllPorts,
                        timeout: 8000,
                        batchSize: 20
                    })
                });

                if (!response.ok) {
                    throw new Error(`ËØ∑Ê±ÇÂ§±Ë¥•: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Êî∂Âà∞Êâ´ÊèèÁªìÊûú:', result);
                logMessage('info', 'Êî∂Âà∞Êâ´ÊèèÂìçÂ∫îÔºåÊ≠£Âú®Â§ÑÁêÜÁªìÊûú...');
                displayScanResult(result);
                logMessage('success', 'Êâ´ÊèèÂÆåÊàê');

            } catch (error) {
                logMessage('error', `Êâ´ÊèèÂ§±Ë¥•: ${error.message}`);
                document.getElementById('resultContent').textContent = `Êâ´ÊèèÂ§±Ë¥•: ${error.message}`;
            } finally {
                isScanning = false;
                scanBtn.disabled = false;
                scanBtn.textContent = 'üöÄ ÂºÄÂßãÊâ´Êèè';
                progressBar.style.display = 'none';
            }
        }

        // ÊòæÁ§∫Êâ´ÊèèÁªìÊûú
        function displayScanResult(result) {
            const resultContent = document.getElementById('resultContent');
            const statusSummary = document.getElementById('statusSummary');

            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            document.getElementById('openCount').textContent = result.openPorts ? result.openPorts.length : 0;
            document.getElementById('closedCount').textContent = result.closedPorts ? result.closedPorts.length : 0;
            document.getElementById('timeoutCount').textContent = result.timeoutPorts ? result.timeoutPorts.length : 0;
            document.getElementById('errorCount').textContent = result.errorPorts ? result.errorPorts.length : 0;

            statusSummary.style.display = 'grid';

            // ÊûÑÂª∫ÁªìÊûúÊòæÁ§∫
            let resultText = '';
            resultText += `Êâ´Êèè‰∏ªÊú∫: ${result.host}\n`;
            resultText += `Êâ´ÊèèÊó∂Èó¥: ${result.startTime} - ${result.endTime}\n`;
            resultText += `Êâ´ÊèèËÄóÊó∂: ${result.duration}\n`;
            resultText += `ÊÄªËÆ°Á´ØÂè£: ${result.totalScanned}\n`;
            resultText += `=========================================\n\n`;

            if (result.openPorts && result.openPorts.length > 0) {
                resultText += `üü¢ ÂºÄÊîæÁ´ØÂè£ (${result.openPorts.length} ‰∏™):\n`;
                resultText += `${result.openPorts.join(', ')}\n\n`;
            }

            if (result.closedPorts && result.closedPorts.length > 0) {
                resultText += `üî¥ ÂÖ≥Èó≠Á´ØÂè£ (${result.closedPorts.length} ‰∏™):\n`;
                if (result.closedPorts.length > 50) {
                    resultText += `${result.closedPorts.slice(0, 50).join(', ')}... (‰ªÖÊòæÁ§∫Ââç50‰∏™)\n\n`;
                } else {
                    resultText += `${result.closedPorts.join(', ')}\n\n`;
                }
            }

            if (result.timeoutPorts && result.timeoutPorts.length > 0) {
                resultText += `‚è∞ Ë∂ÖÊó∂Á´ØÂè£ (${result.timeoutPorts.length} ‰∏™):\n`;
                if (result.timeoutPorts.length > 50) {
                    resultText += `${result.timeoutPorts.slice(0, 50).join(', ')}... (‰ªÖÊòæÁ§∫Ââç50‰∏™)\n\n`;
                } else {
                    resultText += `${result.timeoutPorts.join(', ')}\n\n`;
                }
            }

            if (result.errorPorts && result.errorPorts.length > 0) {
                resultText += `‚ùå ÈîôËØØÁ´ØÂè£ (${result.errorPorts.length} ‰∏™):\n`;
                if (result.errorPorts.length > 50) {
                    resultText += `${result.errorPorts.slice(0, 50).join(', ')}... (‰ªÖÊòæÁ§∫Ââç50‰∏™)\n\n`;
                } else {
                    resultText += `${result.errorPorts.join(', ')}\n\n`;
                }
            }

            resultContent.textContent = resultText;

            // ËÆ∞ÂΩïËØ¶ÁªÜÊó•Âøó
            const openCount = result.openPorts ? result.openPorts.length : 0;
            const closedCount = result.closedPorts ? result.closedPorts.length : 0;
            const timeoutCount = result.timeoutPorts ? result.timeoutPorts.length : 0;
            const errorCount = result.errorPorts ? result.errorPorts.length : 0;

            logMessage('success', `Êâ´ÊèèÂÆåÊàê - ÂºÄÊîæ: ${openCount}, ÂÖ≥Èó≠: ${closedCount}, Ë∂ÖÊó∂: ${timeoutCount}, ÈîôËØØ: ${errorCount}`);
            logMessage('info', `ÊÄªËÄóÊó∂: ${result.duration}`);
        }

        // ËÆ∞ÂΩïÊó•ÂøóÊ∂àÊÅØ
        function logMessage(type, message) {
            const logContent = document.getElementById('logContent');
            const logDiv = document.createElement('div');
            logDiv.className = `log-message ${type}`;

            const timestamp = new Date().toLocaleTimeString();

            logDiv.innerHTML = `
                <span class="log-time">[${timestamp}]</span>
                <span class="log-type">${type.toUpperCase()}</span>
                ${message}
            `;

            logContent.appendChild(logDiv);

            // ÈôêÂà∂Êó•ÂøóÊï∞Èáè
            const maxLogs = 500;
            const allLogs = logContent.querySelectorAll('.log-message');
            if (allLogs.length > maxLogs) {
                allLogs[0].remove();
            }

            // Ëá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®
            if (autoScroll) {
                scrollToBottom();
            }
        }

        // ÊªöÂä®Âà∞Â∫ïÈÉ®
        function scrollToBottom() {
            const logContent = document.getElementById('logContent');
            // ‰ΩøÁî®setTimeoutÁ°Æ‰øùDOMÊõ¥Êñ∞ÂêéÂÜçÊªöÂä®
            setTimeout(() => {
                logContent.scrollTop = logContent.scrollHeight;
            }, 10);
        }

        // ÂàáÊç¢Ëá™Âä®ÊªöÂä®
        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoScrollBtn');
            btn.textContent = autoScroll ? 'üìú Ëá™Âä®ÊªöÂä®' : 'üìú ÊâãÂä®ÊªöÂä®';

            if (autoScroll) {
                scrollToBottom();
            }

            logMessage('info', `Ëá™Âä®ÊªöÂä®Â∑≤${autoScroll ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}`);
        }

        // ‰øùÂ≠òÁªìÊûú
        function saveResult() {
            const resultContent = document.getElementById('resultContent');
            const content = `Á´ØÂè£Êâ´ÊèèÁªìÊûú - ${new Date().toLocaleString()}\n${'='.repeat(50)}\n\n${resultContent.textContent}`;

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `port-scan-result-${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logMessage('info', 'Êâ´ÊèèÁªìÊûúÂ∑≤‰øùÂ≠ò');
        }

        // ‰øùÂ≠òÊó•Âøó
        function saveLog() {
            const logMessages = document.querySelectorAll('.log-message');
            let logContent = `Á´ØÂè£Êâ´ÊèèÊó•Âøó - ${new Date().toLocaleString()}\n${'='.repeat(50)}\n\n`;

            logMessages.forEach(msg => {
                logContent += msg.textContent + '\n';
            });

            const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `port-scan-log-${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logMessage('info', 'Êâ´ÊèèÊó•ÂøóÂ∑≤‰øùÂ≠ò');
        }

        // Ê∏ÖÁ©∫ÁªìÊûú
        function clearResult() {
            document.getElementById('resultContent').textContent = 'ÁÇπÂáª"ÂºÄÂßãÊâ´Êèè"ÂºÄÂßãÁ´ØÂè£Ê£ÄÊµã...';
            document.getElementById('statusSummary').style.display = 'none';
            logMessage('info', 'Êâ´ÊèèÁªìÊûúÂ∑≤Ê∏ÖÁ©∫');
        }

        // Ê∏ÖÁ©∫Êó•Âøó
        function clearLog() {
            document.getElementById('logContent').innerHTML = '';
            logMessage('info', 'Êâ´ÊèèÊó•ÂøóÂ∑≤Ê∏ÖÁ©∫');
        }
    </script>
</body>
</html>
